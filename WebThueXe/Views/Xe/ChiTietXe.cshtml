@model WebThueXe.Models.Xe
@using WebThueXe.Models

@{
    ViewBag.Title = "ChiTietXe";
    Layout = "~/Views/Shared/_LayoutTimKiem.cshtml";
}



<style>
    #carouselIndicators {
        margin-top: 10px;
        width: 100%;
    }

    #carouselIndicators .carousel-indicators {
        margin: 10px 0 0;
        overflow: auto;
        position: static;
        text-align: left;
        white-space: nowrap;
        width: 100%;
    }

    #carouselIndicators .carousel-indicators li {
        background-color: transparent;
        -webkit-border-radius: 0;
        border-radius: 0;
        display: inline-block;
        height: auto;
        margin: 0 !important;
        width: auto;
    }

    #carouselIndicators .carousel-indicators li img {
        display: block;
        opacity: 0.5;
    }

    #carouselIndicators .carousel-indicators li.active img {
        opacity: 1;
    }

    #carouselIndicators .carousel-indicators li:hover img {
        opacity: 0.75;
    }

    #carouselIndicators .carousel-outer {
        position: relative;
    }

    .carousel-control.left {
        background-image: none;
        width: 54px;
        height: 54px;
        top: 50%;
        left: 20px;
        margin-top: -27px;
        line-height: 54px;
        border: 2px solid #fff;
        opacity: 1;
        text-shadow: none;
        -webkit-transition: all 0.2s ease-in-out 0s;
        -o-transition: all 0.2s ease-in-out 0s;
        transition: all 0.2s ease-in-out 0s;
    }

    .carousel-control.right {
        background-image: none;
        width: 54px;
        height: 54px;
        top: 50%;
        right: 20px;
        margin-top: -27px;
        line-height: 54px;
        border: 2px solid #fff;
        opacity: 1;
        text-shadow: none;
        -webkit-transition: all 0.2s ease-in-out 0s;
        -o-transition: all 0.2s ease-in-out 0s;
        transition: all 0.2s ease-in-out 0s;
    }
</style>

<h5>@Html.DisplayFor(model => model.tenXe)</h5>
<div class="container" style="border: 1px solid black">
    <br />
    <div class="row">
        <div class="col-md-8">
            <div id="carouselIndicators" class="carousel slide" data-ride="carousel">

                <div class="carousel-inner" id="carouselId">
                    <div class="carousel-item active">
                        <img src="@Model.hinh" class="d-block w-100" alt="..." height="300" />
                    </div>
                </div>

                <a class="carousel-control-prev" href="#carouselIndicators" role="button" data-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="sr-only">Previous</span>
                </a>
                <a class="carousel-control-next" href="#carouselIndicators" role="button" data-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                </a>

                <ol class="carousel-indicators visible-sm-block hidden-xs-block visible-md-block visible-lg-block" id="indicatorId">
                    <li data-target="#carouselIndicators" data-slide-to="0" class="active">
                        <img src="@Model.hinh" alt="..." class="img-responsive" width="100" height="80">
                    </li>
                </ol>
            </div>
        </div>
        <div class="col-md-4">
            <br />
            <div class="container">
                <div class="row">
                    <div class="clearfix"></div>
                    <div class="col-md-8">
                        <div class="container">
                            <div class="row">
                                <div class="col-md-12">
                                    <h5>@Html.DisplayFor(model => model.HieuXe.tenHieuXe)</h5>
                                    <hr />
                                    <p>Loại xe: @Html.DisplayFor(model => model.LoaiXe.tenLoaiXe)</p>
                                    <hr />
                                    <p>Máy lạnh</p>
                                    <hr />
                                    <p>CD, MP3</p>
                                    <hr />
                                    <p>Biển số: @Html.DisplayFor(model => model.bienSo)</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <br />
        </div>
        <div class="col-md-12">
            <br />
        </div>
    </div>
</div>
<br>
<div class="container" style="border: 1px solid black;padding:15px">
    <h4 class="text-center">Thời gian bạn đi</h4>
    <div class="container" style="border: 1px solid black">
        <p><strong>Địa điểm nhận xe: </strong></p>
    </div>
    <div class="row">
        <div class="col-md-6">
            <div class="container">
                <div class="row">
                    <div class="col-md-6">
                        <p>Ngày nhận xe</p>
                    </div>
                    <div class="col-md-6">
                        <p>
                            <input type="date" class="form-control" id="datetimepickerNgayNhan" onchange="countDay()" value="@DateTime.Today.ToString("yyyy-MM-dd")" />
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="container">
                <div class="row">
                    <div class="col-md-6">
                        <p>Ngày trả xe</p>
                    </div>
                    <div class="col-md-6">
                        <p>
                            <input type="date" class="form-control" id="datetimepickerNgayTra" onchange="countDay()" value="@(DateTime.Today.AddDays(1).ToString("yyyy-MM-dd"))" />
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<br>
<div class="container" style="border: 1px solid black;padding: 15px;">
    <h4 class="text-center">Đơn giá xe</h4>
    <div class="row" style="justify-content:center">
        <div class="col-md-6">
            <p>Loại xe</p>
        </div>
        <div class="col-md-6">
            <p class="text-right">@Html.DisplayFor(model => model.LoaiXe.tenLoaiXe)</p>
        </div>

        <hr style="width:100%" />
        <div class="col-md-6">
            <p>Giá thuê xe</p>
        </div>
        <div class="col-md-6">
            <p class="text-right" id="giathue">@Html.DisplayFor(model => model.giaThueXe)</p>
        </div>
        <hr style="width:100%" />
        <div class="col-md-6">
            <p>Số ngày thuê</p>
        </div>
        <div class="col-md-6">
            <p class="text-right" id="SoNgayThue">1</p>
        </div>
        <hr style="width:100%" />
        <div class="col-md-6">
            <p>Thành tiền</p>
        </div>
        <div class="col-md-6">
            <p class="text-right" id="thanhTien"></p>
        </div>
        @Html.ActionLink("Tiếp tục", "HopDongThueXe", "Xe", new { maXe = Model.maXe, tenXe = Model.tenXe, ngayThue = "ngayThueID", ngayTra = "ngayTraID", soNgayThue = "soNgayThueID", tongTien = "tongTienID", donGia = "donGiaID" }, new { id = "DatXe", @class = "btn btn-lg btn-primary" })
    </div>
</div>
<script src="~/Scripts/jquery-3.6.0.js"></script>
<script>
    const predate1 = document.getElementById("datetimepickerNgayNhan").value
    const predate2 = document.getElementById("datetimepickerNgayTra").value
    function countDay() {
        const date1 = Date.parse(document.getElementById("datetimepickerNgayNhan").value);
        const date2 = Date.parse(document.getElementById("datetimepickerNgayTra").value);
        const oneDay = 24 * 60 * 60 * 1000;
        if (date2 - date1 > 0) {
            const diffDays = Math.round((date2 - date1) / oneDay);
            document.getElementById("SoNgayThue").innerHTML = diffDays;

            var tienThue = @Model.giaThueXe;
            var thanhTien = diffDays * tienThue;
            document.getElementById("thanhTien").innerHTML = thanhTien;
        }
        else {
            alert("Ngày trả không được nhỏ hơn ngày nhận");
            document.getElementById("datetimepickerNgayNhan").value = predate1;
            document.getElementById("datetimepickerNgayTra").value = predate2;

        }
    };
    countDay();
    $('#DatXe').click(function () {
        $('#DatXe').attr('href', function () {
            return this.href.replace('ngayThueID', $('#datetimepickerNgayNhan').val());
        });
        $('#DatXe').attr('href', function () {
            return this.href.replace('ngayTraID', $('#datetimepickerNgayTra').val());
        });
        $('#DatXe').attr('href', function () {
            return this.href.replace('soNgayThueID', $('#SoNgayThue').text());
        });
        $('#DatXe').attr('href', function () {
            return this.href.replace('tongTienID', $('#thanhTien').text());
        });
        $('#DatXe').attr('href', function () {
            return this.href.replace('donGiaID', $('#giathue').text());
        });
    })

    $.ajax({
        type: "POST",
        url: "/Xe/LoadImages",
        data: { id:@Model.maXe},
        success: function (response) {
            if (response.status = true) {
                var html = $('#carouselId').html();
                var html2 = $('#indicatorId').html();
                var j = 1;
                var data = response.data;
                $.each(data, function (i, val) {
                    html += '<div class="carousel-item">'+
                                '<img src = "' + val + '" class="d-block w-100" alt = "..." height = "300"/>'+
                            '</div >';
                    html2 += '<li data-target="#carouselIndicators" data-slide-to="'+j+'">'+
                                '<img src = "' + val + '" alt = "..." class="img-responsive" width = "100" height = "80"/>'+
                            '</li >';
                    j++;
                });
                $('#carouselId').html(html);
                $('#indicatorId').html(html2);
            }
        }
    });
</script>